function init(){ed=tinyMCEPopup.editor,tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=ed.dom.getParent(ed.selection.getStart(),"td,th"),t=document.forms[0],l=ed.dom.parseStyle(ed.dom.getAttrib(e,"style")),o=e.nodeName.toLowerCase(),r=ed.dom.getAttrib(e,"align"),d=ed.dom.getAttrib(e,"valign"),a=trimSize(getStyle(e,"width","width")),i=trimSize(getStyle(e,"height","height")),n=convertRGBToHex(getStyle(e,"bordercolor","borderLeftColor")),c=convertRGBToHex(getStyle(e,"bgcolor","backgroundColor")),g=ed.dom.getAttrib(e,"class"),u=getStyle(e,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),s=ed.dom.getAttrib(e,"id"),m=ed.dom.getAttrib(e,"lang"),b=ed.dom.getAttrib(e,"dir"),y=ed.dom.getAttrib(e,"scope");addClassesToList("class","table_cell_styles"),TinyMCE_EditableSelects.init(),ed.dom.hasClass(e,"mceSelected")?tinyMCEPopup.dom.hide("action"):(t.bordercolor.value=n,t.bgcolor.value=c,t.backgroundimage.value=u,t.width.value=a,t.height.value=i,t.id.value=s,t.lang.value=m,t.style.value=ed.dom.serializeStyle(l),selectByValue(t,"align",r),selectByValue(t,"valign",d),selectByValue(t,"class",g,!0,!0),selectByValue(t,"celltype",o),selectByValue(t,"dir",b),selectByValue(t,"scope",y),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"))}function updateAction(){function e(e){e&&(updateCell(l),ed.addVisual(),ed.nodeChanged(),d.execCommand("mceEndUndoLevel"),tinyMCEPopup.close())}var t,l,o,r,d=ed,a=document.forms[0];if(!AutoValidator.validate(a))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(a).join(". ")+"."),!1;if(tinyMCEPopup.restoreSelection(),t=ed.selection.getStart(),l=ed.dom.getParent(t,"td,th"),o=ed.dom.getParent(t,"tr"),r=ed.dom.getParent(t,"table"),ed.dom.hasClass(l,"mceSelected"))return tinymce.each(ed.dom.select("td.mceSelected,th.mceSelected"),function(e){updateCell(e)}),ed.addVisual(),ed.nodeChanged(),d.execCommand("mceEndUndoLevel"),void tinyMCEPopup.close();switch(getSelectValue(a,"action")){case"cell":var i=getSelectValue(a,"celltype"),n=getSelectValue(a,"scope");if(ed.getParam("accessibility_warnings",1))return void("th"==i&&""==n?tinyMCEPopup.confirm(ed.getLang("table_dlg.missing_scope","",!0),e):e(1));updateCell(l);break;case"row":var c=o.firstChild;"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do c=updateCell(c,!0);while(null!=(c=nextCell(c)));break;case"col":var g,u=0,c=o.firstChild,s=r.getElementsByTagName("tr");"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do{if(c==l)break;u+=c.getAttribute("colspan")?c.getAttribute("colspan"):1}while(null!=(c=nextCell(c)));for(var m=0;m<s.length;m++){c=s[m].firstChild,"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c)),g=0;do{if(g==u){c=updateCell(c,!0);break}g+=c.getAttribute("colspan")?c.getAttribute("colspan"):1}while(null!=(c=nextCell(c)))}break;case"all":for(var s=r.getElementsByTagName("tr"),m=0;m<s.length;m++){var c=s[m].firstChild;"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do c=updateCell(c,!0);while(null!=(c=nextCell(c)))}}ed.addVisual(),ed.nodeChanged(),d.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function nextCell(e){for(;null!=(e=e.nextSibling);)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function updateCell(e,t){var l=ed,o=document.forms[0],r=e.nodeName.toLowerCase(),d=getSelectValue(o,"celltype"),a=l.getDoc(),i=ed.dom;if(t||i.setAttrib(e,"id",o.id.value),i.setAttrib(e,"align",o.align.value),i.setAttrib(e,"vAlign",o.valign.value),i.setAttrib(e,"lang",o.lang.value),i.setAttrib(e,"dir",getSelectValue(o,"dir")),i.setAttrib(e,"style",ed.dom.serializeStyle(ed.dom.parseStyle(o.style.value))),i.setAttrib(e,"scope",o.scope.value),i.setAttrib(e,"class",getSelectValue(o,"class")),ed.dom.setAttrib(e,"width",""),ed.dom.setAttrib(e,"height",""),ed.dom.setAttrib(e,"bgColor",""),ed.dom.setAttrib(e,"borderColor",""),ed.dom.setAttrib(e,"background",""),e.style.width=getCSSSize(o.width.value),e.style.height=getCSSSize(o.height.value),""!=o.bordercolor.value?(e.style.borderColor=o.bordercolor.value,e.style.borderStyle=""==e.style.borderStyle?"solid":e.style.borderStyle,e.style.borderWidth=""==e.style.borderWidth?"1px":e.style.borderWidth):e.style.borderColor="",e.style.backgroundColor=o.bgcolor.value,""!=o.backgroundimage.value?e.style.backgroundImage="url('"+o.backgroundimage.value+"')":e.style.backgroundImage="",r!=d){for(var n=a.createElement(d),c=0;c<e.childNodes.length;c++)n.appendChild(e.childNodes[c].cloneNode(1));for(var g=0;g<e.attributes.length;g++)ed.dom.setAttrib(n,e.attributes[g].name,ed.dom.getAttrib(e,e.attributes[g].name));e.parentNode.replaceChild(n,e),e=n}return i.setAttrib(e,"style",i.serializeStyle(i.parseStyle(e.style.cssText))),e}function changedBackgroundImage(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=ed.dom.serializeStyle(t)}function changedSize(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value),l=e.width.value;""!=l?t.width=getCSSSize(l):t.width="";var o=e.height.value;""!=o?t.height=getCSSSize(o):t.height="",e.style.value=ed.dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,t["border-color"]=e.bordercolor.value,e.style.value=ed.dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]?e.backgroundimage.value=t["background-image"].replace(new RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):e.backgroundimage.value="",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var ed;tinyMCEPopup.onInit.add(init);