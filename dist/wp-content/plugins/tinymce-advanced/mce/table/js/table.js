function insertTable(){var e,t,r,l,o,a,i,n,s,c,d,g,u=document.forms[0],m=tinyMCEPopup.editor,b=m.dom,p=2,y=2,h=0,v=-1,k=-1,S="";if(tinyMCEPopup.restoreSelection(),!AutoValidator.validate(u))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(u).join(". ")+"."),!1;if(s=b.getParent(m.selection.getNode(),"table"),p=u.elements.cols.value,y=u.elements.rows.value,h=""!=u.elements.border.value?u.elements.border.value:0,v=""!=u.elements.cellpadding.value?u.elements.cellpadding.value:"",k=""!=u.elements.cellspacing.value?u.elements.cellspacing.value:"",e=getSelectValue(u,"align"),a=getSelectValue(u,"tframe"),i=getSelectValue(u,"rules"),t=u.elements.width.value,r=u.elements.height.value,bordercolor=u.elements.bordercolor.value,bgcolor=u.elements.bgcolor.value,l=getSelectValue(u,"class"),id=u.elements.id.value,summary=u.elements.summary.value,style=u.elements.style.value,dir=u.elements.dir.value,lang=u.elements.lang.value,background=u.elements.backgroundimage.value,o=u.elements.caption.checked,c=tinyMCEPopup.getParam("table_cell_limit",!1),d=tinyMCEPopup.getParam("table_row_limit",!1),g=tinyMCEPopup.getParam("table_col_limit",!1),g&&p>g)return tinyMCEPopup.alert(m.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,g)),!1;if(d&&y>d)return tinyMCEPopup.alert(m.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,d)),!1;if(c&&p*y>c)return tinyMCEPopup.alert(m.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,c)),!1;if("update"==action)return b.setAttrib(s,"cellPadding",v,!0),b.setAttrib(s,"cellSpacing",k,!0),isCssSize(h)?b.setAttrib(s,"border",""):b.setAttrib(s,"border",h),""==h&&(b.setStyle(s,"border-width",""),b.setStyle(s,"border",""),b.setAttrib(s,"border","")),b.setAttrib(s,"align",e),b.setAttrib(s,"frame",a),b.setAttrib(s,"rules",i),b.setAttrib(s,"class",l),b.setAttrib(s,"style",style),b.setAttrib(s,"id",id),b.setAttrib(s,"summary",summary),b.setAttrib(s,"dir",dir),b.setAttrib(s,"lang",lang),n=m.dom.select("caption",s)[0],n&&!o&&n.parentNode.removeChild(n),!n&&o&&(n=s.ownerDocument.createElement("caption"),tinymce.isIE||(n.innerHTML='<br data-mce-bogus="1"/>'),s.insertBefore(n,s.firstChild)),t&&m.settings.inline_styles?(b.setStyle(s,"width",t),b.setAttrib(s,"width","")):(b.setAttrib(s,"width",t,!0),b.setStyle(s,"width","")),b.setAttrib(s,"borderColor",""),b.setAttrib(s,"bgColor",""),b.setAttrib(s,"background",""),r&&m.settings.inline_styles?(b.setStyle(s,"height",r),b.setAttrib(s,"height","")):(b.setAttrib(s,"height",r,!0),b.setStyle(s,"height","")),""!=background?s.style.backgroundImage="url('"+background+"')":s.style.backgroundImage="",""!=bordercolor?(s.style.borderColor=bordercolor,s.style.borderStyle=""==s.style.borderStyle?"solid":s.style.borderStyle,s.style.borderWidth=cssSize(h)):s.style.borderColor="",s.style.backgroundColor=bgcolor,s.style.height=getCSSSize(r),m.addVisual(),m.nodeChanged(),m.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),(u.width.value!=orgTableWidth||u.height.value!=orgTableHeight)&&m.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;S+="<table",S+=makeAttrib("id",id),isCssSize(h)||(S+=makeAttrib("border",h)),S+=makeAttrib("cellpadding",v),S+=makeAttrib("cellspacing",k),S+=makeAttrib("data-mce-new","1"),t&&m.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(t)&&(t+="px"),style+="width: "+t):S+=makeAttrib("width",t),S+=makeAttrib("align",e),S+=makeAttrib("frame",a),S+=makeAttrib("rules",i),S+=makeAttrib("class",l),S+=makeAttrib("style",style),S+=makeAttrib("summary",summary),S+=makeAttrib("dir",dir),S+=makeAttrib("lang",lang),S+=">",o&&(S+=tinymce.isIE?"<caption></caption>":'<caption><br data-mce-bogus="1"/></caption>');for(var C=0;y>C;C++){S+="<tr>";for(var A=0;p>A;A++)S+=tinymce.isIE?"<td></td>":'<td><br data-mce-bogus="1"/></td>';S+="</tr>"}if(S+="</table>",m.settings.fix_table_elements){var f="";m.focus(),m.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(e){f&&(f+=","),f+=e+" ._mce_marker"}),tinymce.each(m.dom.select(f),function(e){m.dom.split(m.dom.getParent(e,"h1,h2,h3,h4,h5,h6,p"),e)}),b.setOuterHTML(b.select("br._mce_marker")[0],S)}else m.execCommand("mceInsertContent",!1,S);tinymce.each(b.select("table[data-mce-new]"),function(e){var t=b.select("td,th",e);tinymce.isIE&&null==e.nextSibling&&(m.settings.forced_root_block?b.insertAfter(b.create(m.settings.forced_root_block),e):b.insertAfter(b.create("br",{"data-mce-bogus":"1"}),e));try{m.selection.setCursorLocation(t[0],0)}catch(r){}b.setAttrib(e,"data-mce-new","")}),m.addVisual(),m.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),tinyMCEPopup.close()}function makeAttrib(e,t){var r=document.forms[0],l=r.elements[e];return("undefined"==typeof t||null==t)&&(t="",l&&(t=l.value)),""==t?"":(t=t.replace(/&/g,"&amp;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")," "+e+'="'+t+'"')}function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=2,t=2,r=tinyMCEPopup.getParam("table_default_border","0"),l=tinyMCEPopup.getParam("table_default_cellpadding",""),o=tinyMCEPopup.getParam("table_default_cellspacing",""),a="",i="",n="",s="",c="",d="",g="",u="",m="",b="",p="",y="",c="",s="",h="",v="",k=tinyMCEPopup.editor,S=k.dom,C=document.forms[0],A=S.getParent(k.selection.getNode(),"table");if(tinymce.each("summary id rules dir style frame".split(" "),function(e){var t=tinyMCEPopup.dom.getParent(e,"tr")||tinyMCEPopup.dom.getParent("t"+e,"tr");t&&!tinyMCEPopup.editor.schema.isValid("table",e)&&(t.style.display="none")}),action=tinyMCEPopup.getWindowArg("action"),action||(action=A?"update":"insert"),A&&"insert"!=action){for(var f=A.rows,e=0,_=0;_<f.length;_++)f[_].cells.length>e&&(e=f[_].cells.length);e=e,t=f.length,st=S.parseStyle(S.getAttrib(A,"style")),r=trimSize(getStyle(A,"border","borderWidth")),l=S.getAttrib(A,"cellpadding",""),o=S.getAttrib(A,"cellspacing",""),i=trimSize(getStyle(A,"width","width")),n=trimSize(getStyle(A,"height","height")),s=convertRGBToHex(getStyle(A,"bordercolor","borderLeftColor")),c=convertRGBToHex(getStyle(A,"bgcolor","backgroundColor")),a=S.getAttrib(A,"align",a),v=S.getAttrib(A,"frame"),h=S.getAttrib(A,"rules"),d=tinymce.trim(S.getAttrib(A,"class").replace(/mceItem.+/g,"")),g=S.getAttrib(A,"id"),u=S.getAttrib(A,"summary"),m=S.serializeStyle(st),b=S.getAttrib(A,"dir"),p=S.getAttrib(A,"lang"),y=getStyle(A,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),C.caption.checked=A.getElementsByTagName("caption").length>0,orgTableWidth=i,orgTableHeight=n,action="update",C.insert.value=k.getLang("update")}addClassesToList("class","table_styles"),TinyMCE_EditableSelects.init(),selectByValue(C,"align",a),selectByValue(C,"tframe",v),selectByValue(C,"rules",h),selectByValue(C,"class",d,!0,!0),C.cols.value=e,C.rows.value=t,C.border.value=r,C.cellpadding.value=l,C.cellspacing.value=o,C.width.value=i,C.height.value=n,C.bordercolor.value=s,C.bgcolor.value=c,C.id.value=g,C.summary.value=u,C.style.value=m,C.dir.value=b,C.lang.value=p,C.backgroundimage.value=y,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),"update"==action&&(C.cols.disabled=!0,C.rows.disabled=!0)}function changedSize(){var e=document.forms[0],t=dom.parseStyle(e.style.value),r=e.height.value;""!=r?t.height=getCSSSize(r):t.height="",e.style.value=dom.serializeStyle(t)}function isCssSize(e){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(e)}function cssSize(e,t){return e=tinymce.trim(e||t),isCssSize(e)?e:parseInt(e,10)+"px"}function changedBackgroundImage(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=dom.serializeStyle(t)}function changedBorder(){var e=document.forms[0],t=dom.parseStyle(e.style.value);""==e.border.value||!isCssSize(e.border.value)&&""==e.bordercolor.value?e.border.value||(t.border="",t["border-width"]=""):t["border-width"]=cssSize(e.border.value),e.style.value=dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,""!=e.bordercolor.value&&(t["border-color"]=e.bordercolor.value,t["border-width"]||(t["border-width"]=cssSize(e.border.value,1))),e.style.value=dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-image"]?e.backgroundimage.value=t["background-image"].replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):e.backgroundimage.value="",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;tinyMCEPopup.onInit.add(init);