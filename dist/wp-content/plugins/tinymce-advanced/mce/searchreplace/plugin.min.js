!function(){function e(e,t,n,a,r){function i(e,t){if(t=t||0,!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var n=e.index;if(t>0){var a=e[t];if(!a)throw"Invalid capture group";n+=e[0].indexOf(a),e[0]=a}return[n,n+e[0].length,[e[0]]]}function d(e){var t;if(3===e.nodeType)return e.data;if(m[e.nodeName]&&!u[e.nodeName])return"";if(t="",(u[e.nodeName]||h[e.nodeName])&&(t+="\n"),e=e.firstChild)do t+=d(e);while(e=e.nextSibling);return t}function o(e,t,n){var a,r,i,d,o=[],l=0,c=e,s=t.shift(),f=0;e:for(;;){if((u[c.nodeName]||h[c.nodeName])&&l++,3===c.nodeType&&(!r&&c.length+l>=s[1]?(r=c,d=s[1]-l):a&&o.push(c),!a&&c.length+l>s[0]&&(a=c,i=s[0]-l),l+=c.length),a&&r){if(c=n({startNode:a,startNodeIndex:i,endNode:r,endNodeIndex:d,innerNodes:o,match:s[2],matchIndex:f}),l-=r.length-d,a=null,r=null,o=[],s=t.shift(),f++,!s)break}else{if((!m[c.nodeName]||u[c.nodeName])&&c.firstChild){c=c.firstChild;continue}if(c.nextSibling){c=c.nextSibling;continue}}for(;;){if(c.nextSibling){c=c.nextSibling;break}if(c.parentNode===e)break e;c=c.parentNode}}}function l(e){var t;if("function"!=typeof e){var n=e.nodeType?e:f.createElement(e);t=function(e,t){var a=n.cloneNode(!1);return a.setAttribute("data-mce-index",t),e&&a.appendChild(f.createTextNode(e)),a}}else t=e;return function(e){var n,a,r,i=e.startNode,d=e.endNode,o=e.matchIndex;if(i===d){var l=i;r=l.parentNode,e.startNodeIndex>0&&(n=f.createTextNode(l.data.substring(0,e.startNodeIndex)),r.insertBefore(n,l));var c=t(e.match[0],o);return r.insertBefore(c,l),e.endNodeIndex<l.length&&(a=f.createTextNode(l.data.substring(e.endNodeIndex)),r.insertBefore(a,l)),l.parentNode.removeChild(l),c}n=f.createTextNode(i.data.substring(0,e.startNodeIndex)),a=f.createTextNode(d.data.substring(e.endNodeIndex));for(var s=t(i.data.substring(e.startNodeIndex),o),u=[],m=0,h=e.innerNodes.length;h>m;++m){var p=e.innerNodes[m],g=t(p.data,o);p.parentNode.replaceChild(g,p),u.push(g)}var v=t(d.data.substring(0,e.endNodeIndex),o);return r=i.parentNode,r.insertBefore(n,i),r.insertBefore(s,i),r.removeChild(i),r=d.parentNode,r.insertBefore(v,d),r.insertBefore(a,d),r.removeChild(d),v}}var c,s,f,u,m,h,p=[],g=0;if(f=t.ownerDocument,u=r.getBlockElements(),m=r.getWhiteSpaceElements(),h=r.getShortEndedElements(),s=d(t)){if(e.global)for(;c=e.exec(s);)p.push(i(c,a));else c=s.match(e),p.push(i(c,a));return p.length&&(g=p.length,o(t,p,l(n))),g}}function t(t){function n(){function e(){i.statusbar.find("#next").disabled(!d(f+1).length),i.statusbar.find("#prev").disabled(!d(f-1).length)}function n(){tinymce.ui.MessageBox.alert("Could not find the specified string.",function(){i.find("#find")[0].focus()})}var a,r={};a=tinymce.trim(t.selection.getContent({format:"text"}));var i=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){t.focus(),s.done()},onSubmit:function(t){var a,o,l,c;return t.preventDefault(),o=i.find("#case").checked(),c=i.find("#words").checked(),l=i.find("#find").value(),l.length?r.text==l&&r.caseState==o&&r.wholeWord==c?0===d(f+1).length?void n():(s.next(),void e()):(a=s.find(l,o,c),a||n(),i.statusbar.items().slice(1).disabled(0===a),e(),void(r={text:l,caseState:o,wholeWord:c})):(s.done(!1),void i.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){i.submit()}},{text:"Replace",disabled:!0,onclick:function(){s.replace(i.find("#replace").value())||(i.statusbar.items().slice(1).disabled(!0),f=-1,r={})}},{text:"Replace all",disabled:!0,onclick:function(){s.replace(i.find("#replace").value(),!0,!0),i.statusbar.items().slice(1).disabled(!0),r={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){s.prev(),e()}},{text:"Next",name:"next",disabled:!0,onclick:function(){s.next(),e()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:a},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow()}function a(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function r(n){var a,r;return r=t.dom.create("span",{"data-mce-bogus":1}),r.className="mce-match-marker",a=t.getBody(),s.done(!1),e(n,a,r,!1,t.schema)}function i(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function d(e){var n,r=[];if(n=tinymce.toArray(t.getBody().getElementsByTagName("span")),n.length)for(var i=0;i<n.length;i++){var d=a(n[i]);null!==d&&d.length&&d===e.toString()&&r.push(n[i])}return r}function o(e){var n=f,a=t.dom;e=e!==!1,e?n++:n--,a.removeClass(d(f),"mce-match-marker-selected");var r=d(n);return r.length?(a.addClass(d(n),"mce-match-marker-selected"),t.selection.scrollIntoView(r[0]),n):-1}function l(e){var n=t.dom,a=e.parentNode;n.remove(e),n.isEmpty(a)&&n.remove(a)}function c(e){var t=a(e);return null!==t&&t.length>0}var s=this,f=-1;s.init=function(e){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:n,separator:"before",context:"edit"}),e.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:n}),e.addCommand("SearchReplace",n),e.shortcuts.add("Meta+F","",n)},s.find=function(e,t,n){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e=n?"\\b"+e+"\\b":e;var a=r(new RegExp(e,t?"g":"gi"));return a&&(f=-1,f=o(!0)),a},s.next=function(){var e=o(!0);-1!==e&&(f=e)},s.prev=function(){var e=o(!1);-1!==e&&(f=e)},s.replace=function(e,n,r){var o,u,m,h,p,g,v=f;for(n=n!==!1,m=t.getBody(),u=tinymce.grep(tinymce.toArray(m.getElementsByTagName("span")),c),o=0;o<u.length;o++){var x=a(u[o]);if(h=p=parseInt(x,10),r||h===f){for(e.length?(u[o].firstChild.nodeValue=e,i(u[o])):l(u[o]);u[++o];){if(h=parseInt(a(u[o]),10),h!==p){o--;break}l(u[o])}n&&v--}else p>f&&u[o].setAttribute("data-mce-index",p-1)}return t.undoManager.add(),f=v,n?(g=d(v+1).length>0,s.next()):(g=d(v-1).length>0,s.prev()),!r&&g},s.done=function(e){var n,r,d,o;for(r=tinymce.toArray(t.getBody().getElementsByTagName("span")),n=0;n<r.length;n++){var l=a(r[n]);null!==l&&l.length&&(l===f.toString()&&(d||(d=r[n].firstChild),o=r[n].firstChild),i(r[n]))}if(d&&o){var c=t.dom.createRng();return c.setStart(d,0),c.setEnd(o,o.data.length),e!==!1&&t.selection.setRng(c),c}}}tinymce.PluginManager.add("searchreplace",t)}();