function ancestors(e){if(parents=tinymce.DOM.getParent(e.parentNode,"div")){if(tinymce.DOM.hasClass(parents,"vcard"))return parents;ancestors(parents)}return parents}function getData(e){for(var d in e.childNodes)if(1==e.childNodes[d].nodeType){var t=tinymce.DOM.getAttrib(e.childNodes[d],"class");switch(t){case"url":case"url fn n":-1!=tinymce.DOM.getAttrib(e.childNodes[d],"href").indexOf("aim:goim?screenname=")?document.getElementById("aim").value=unescape(tinymce.DOM.getAttrib(e.childNodes[d],"href").replace(/aim:goim\?screenname=/i,"")):-1!=tinymce.DOM.getAttrib(e.childNodes[d],"href").indexOf("ymsgr:sendIM?")?document.getElementById("yim").value=unescape(tinymce.DOM.getAttrib(e.childNodes[d],"href").replace(/ymsgr:sendIM\?/i,"")):-1!=tinymce.DOM.getAttrib(e.childNodes[d],"href").indexOf("xmpp:")?document.getElementById("jabber").value=unescape(tinymce.DOM.getAttrib(e.childNodes[d],"href").replace(/xmpp:/i,"")):-1!=tinymce.DOM.getAttrib(e.childNodes[d],"href").indexOf("skype:")?(document.getElementById("skype").value=tinymce.DOM.getAttrib(e.childNodes[d],"href").substr(6),document.getElementById("skype").value=unescape(document.getElementById("skype").value.substr(0,document.getElementById("skype").value.length-4))):document.getElementById("url").value=tinymce.DOM.getAttrib(e.childNodes[d],"href");break;case"given-name":document.getElementById("givenName").value=e.childNodes[d].firstChild.nodeValue;break;case"additional-name":document.getElementById("middleName").value=e.childNodes[d].firstChild.nodeValue;break;case"family-name":document.getElementById("familyName").value=e.childNodes[d].firstChild.nodeValue;break;case"org":document.getElementById("organization").value=e.childNodes[d].firstChild.nodeValue;break;case"photo":document.getElementById("photoURL").value=tinymce.DOM.getAttrib(e.childNodes[d],"src");break;case"note":document.getElementById("note").value=e.childNodes[d].firstChild.nodeValue;break;case"street-address":document.getElementById("street").value=e.childNodes[d].firstChild.nodeValue;break;case"locality":document.getElementById("city").value=e.childNodes[d].firstChild.nodeValue;break;case"region":document.getElementById("state").value=e.childNodes[d].firstChild.nodeValue;break;case"postal-code":document.getElementById("postalCode").value=e.childNodes[d].firstChild.nodeValue;break;case"country-name":document.getElementById("country").value=e.childNodes[d].firstChild.nodeValue;break;case"tel":var n="",o="";for(var a in e.childNodes[d].childNodes)"type"==tinymce.DOM.getAttrib(e.childNodes[d].childNodes[a],"class")&&("pref"==tinymce.DOM.getAttrib(e.childNodes[d].childNodes[a],"title")?n=!0:o=e.childNodes[d].childNodes[a].firstChild.nodeValue.toLowerCase());if("cell"==o&&(o="mobile"),"work"==o&&(o="business"),""!=o&&(nodeTextArray=scrapeText(e.childNodes[d],!0),endDes=nodeTextArray[nodeTextArray.length-1].indexOf(" "),phoneNumber=nodeTextArray[nodeTextArray.length-1].substr(endDes+1),document.getElementById(o+"Phone").value=phoneNumber),n)for(i=0;i<document.forms[0].phonePref.length;i++)document.forms[0].phonePref[i].value==o&&(document.forms[0].phonePref[i].checked=!0);break;case"email":document.getElementById("email").value=tinymce.DOM.getAttrib(e.childNodes[d],"href").replace(/mailto:/i,"");break;case"tags":var l=e.childNodes[d].childNodes;for(var s in l)"1"==l[s].nodeType&&(""!=document.getElementById("tags").value&&(document.getElementById("tags").value+=", "),document.getElementById("tags").value+=l[s].firstChild.nodeValue)}e.childNodes[d].childNodes.length>0&&getData(e.childNodes[d])}}function codeit(){var e=document.getElementById("givenName").value,d=document.getElementById("middleName").value,t=document.getElementById("familyName").value,n=document.getElementById("organization").value,o=document.getElementById("photoURL").value,a=document.getElementById("note").value,l=document.getElementById("tags").value,s=document.getElementById("street").value,c=document.getElementById("city").value,i=document.getElementById("state").value,r=document.getElementById("postalCode").value,m=document.getElementById("country").value,p=document.getElementById("homePhone").value,N=document.getElementById("businessPhone").value,u=document.getElementById("mobilePhone").value;for(V=0;V<document.forms[0].phonePref.length;V++)if(document.forms[0].phonePref[V].checked)var h=document.forms[0].phonePref[V].value;var g=document.getElementById("email").value,y=document.getElementById("url").value,f=document.getElementById("aim").value,v=document.getElementById("yim").value,I=document.getElementById("jabber").value,C=document.getElementById("skype").value;if(e||t||!n){var E=e;d&&(E+=" "+d),t&&(E+=" "+t);var b=!1}else var E=n,b=!0;var B=DIV({"class":"vcard",id:""!=e?"hcard-"+E.replace(/ /g,"-"):""});if(o&&o.match(/http:\/\/.*\..{2,4}.*/)&&appendChildNodes(B,IMG({style:"float:left; margin-right:4px","class":"photo",src:o,alt:"Photo of "+E})),y&&y.match(/http:\/\/.*\..{2,4}.*/))D=A({"class":"url fn n",href:y}),appendChildNodes(B,D);else{var D=SPAN({"class":"fn n"});appendChildNodes(B,D)}if(b?appendChildNodes(D,DIV({"class":"org"},n)):(appendChildNodes(D,SPAN({"class":"given-name"},e)),appendChildNodes(D," "),appendChildNodes(D,SPAN({"class":"additional-name"},d)),appendChildNodes(D," "),appendChildNodes(D,SPAN({"class":"family-name"},t)),n&&appendChildNodes(B,DIV({"class":"org"},n))),g&&(emailNode=A({"class":"email",href:"mailto:"+g},g),appendChildNodes(B,emailNode)),p&&(contentNode=DIV({"class":"tel"}),appendChildNodes(B,contentNode),phoneNode=SPAN({"class":"type"},"Home"),appendChildNodes(contentNode,phoneNode),"home"==h?(prefNode=ABBR({"class":"type",title:"pref"},"(Preferred): "),appendChildNodes(contentNode,prefNode)):appendChildNodes(contentNode,": "),appendChildNodes(contentNode,p)),N&&(contentNode=DIV({"class":"tel"}),appendChildNodes(B,contentNode),phoneNode=SPAN({"class":"type"},"Work"),appendChildNodes(contentNode,phoneNode),"business"==h?(prefNode=ABBR({"class":"type",title:"pref"},"(Preferred): "),appendChildNodes(contentNode,prefNode)):appendChildNodes(contentNode,": "),appendChildNodes(contentNode,N)),u&&(contentNode=DIV({"class":"tel"}),appendChildNodes(B,contentNode),phoneNode=SPAN({"class":"type"},"Cell"),appendChildNodes(contentNode,phoneNode),"mobile"==h?(prefNode=ABBR({"class":"type",title:"pref"},"(Preferred): "),appendChildNodes(contentNode,prefNode)):appendChildNodes(contentNode,": "),appendChildNodes(contentNode,u)),(s||c||i||r||m)&&(contentNode=DIV({"class":"adr"}),appendChildNodes(B,contentNode),s&&(adrNode=DIV({"class":"street-address"},s),appendChildNodes(contentNode,adrNode)),c&&(adrNode=SPAN({"class":"locality"},c),appendChildNodes(contentNode,adrNode),(i||r||m)&&appendChildNodes(contentNode,", ")),i&&(adrNode=SPAN({"class":"region"},i),appendChildNodes(contentNode,adrNode),(r||m)&&appendChildNodes(contentNode,", ")),m&&(adrNode=SPAN({"class":"country-name"},m),appendChildNodes(contentNode,adrNode),r&&appendChildNodes(contentNode," ")),r&&(adrNode=SPAN({"class":"postal-code"},r),appendChildNodes(contentNode,adrNode))),f&&(imNode=A({"class":"url",href:"aim:goim?screenname="+f},f),contentNode=DIV({"class":"im"},"AIM: "),appendChildNodes(B,contentNode),appendChildNodes(contentNode,imNode)),v&&(imNode=A({"class":"url",href:"ymsgr:sendIM?"+v},v),contentNode=DIV({"class":"im"},"Yahoo Messenger: "),appendChildNodes(B,contentNode),appendChildNodes(contentNode,imNode)),I&&(imNode=A({"class":"url",href:"xmpp:"+I},I),contentNode=DIV({"class":"im"},"Jabber: "),appendChildNodes(B,contentNode),appendChildNodes(contentNode,imNode)),C&&(imNode=A({"class":"url",href:"skype:"+C+"?add"},C),contentNode=DIV({"class":"im"},"Skype: "),appendChildNodes(B,contentNode),appendChildNodes(contentNode,imNode)),a&&(contentNode=P({"class":"note"},a),appendChildNodes(B,contentNode)),l){var M=l.split(","),k=DIV({"class":"tags"},"Tags: ");for(var V in M)appendChildNodes(k,A({rel:"tag",href:"http://eventful.com/events/tags/"+encodeURI(M[V])},M[V]));appendChildNodes(B,k)}var O=DIV({},B);return result=O.innerHTML,result}function escape_output(e){var d=/\s&\s/gi,t=/\s\<\s/gi,n=/\s>\s/gi,o=e.replace(d," &amp; ");o=o.replace(t," &lt; ");var a=o.replace(n," &gt; ");return a}function tabChange(e){switch(e){case"basic":document.getElementById("basic-tab").className="",document.getElementById("address-tab").className="hidden",document.getElementById("contact-tab").className="hidden";break;case"address":document.getElementById("basic-tab").className="hidden",document.getElementById("address-tab").className="",document.getElementById("contact-tab").className="hidden";break;case"contact":document.getElementById("basic-tab").className="hidden",document.getElementById("address-tab").className="hidden",document.getElementById("contact-tab").className=""}return!1}tinyMCEPopup.requireLangPack();var ExampleDialog={init:function(){var e=document.forms[0];if(selectedElement=tinyMCEPopup.editor.selection.getNode(),null!=selectedElement)var d=ancestors(selectedElement);null!=d?getData(d):e.givenName.value=tinyMCEPopup.editor.selection.getContent({format:"text"})},insert:function(){if(selectedElement=tinyMCEPopup.editor.selection.getNode(),null!=selectedElement)var e=ancestors(selectedElement);null!=e?tinyMCEPopup.editor.dom.setOuterHTML(e,codeit()):tinyMCEPopup.editor.execCommand("mceInsertContent",!1,codeit()),tinyMCEPopup.close()}};tinyMCEPopup.onInit.add(ExampleDialog.init,ExampleDialog);