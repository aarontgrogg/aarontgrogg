function JetpackLikespostMessage(e,t){if("string"==typeof e)try{e=JSON.parse(e)}catch(i){return}pm({target:t,type:"likesMessage",data:e,origin:"*"})}function JetpackLikesBatchHandler(){var e=[];jQuery("div.jetpack-likes-widget-unloaded").each(function(){if(!(jetpackLikesWidgetBatch.indexOf(this.id)>-1)){jetpackLikesWidgetBatch.push(this.id);var t,i=/like-(post|comment)-wrapper-(\d+)-(\d+)-(\w+)/,s=i.exec(this.id);s&&5===s.length&&(t={blog_id:s[2],width:this.width},"post"===s[1]?t.post_id=s[3]:"comment"===s[1]&&(t.comment_id=s[3]),t.obj_id=s[4],e.push(t))}}),e.length>0&&JetpackLikespostMessage({event:"initialBatch",requests:e},window.frames["likes-master"])}function JetpackLikesMessageListener(e){if("undefined"!=typeof e.event&&("masterReady"===e.event&&jQuery(document).ready(function(){jetpackLikesMasterReady=!0;var e={event:"injectStyles"},t=jQuery(".sd-text-color"),i=jQuery(".sd-link-color");jQuery("iframe.admin-bar-likes-widget").length>0&&(JetpackLikespostMessage({event:"adminBarEnabled"},window.frames["likes-master"]),e.adminBarStyles={background:jQuery("#wpadminbar .quicklinks li#wp-admin-bar-wpl-like > a").css("background"),isRtl:"rtl"===jQuery("#wpadminbar").css("direction")}),window.addEventListener||jQuery("#wp-admin-bar-admin-bar-likes-widget").hide(),e.textStyles={color:t.css("color"),fontFamily:t.css("font-family"),fontSize:t.css("font-size"),direction:t.css("direction"),fontWeight:t.css("font-weight"),fontStyle:t.css("font-style"),textDecoration:t.css("text-decoration")},e.linkStyles={color:i.css("color"),fontFamily:i.css("font-family"),fontSize:i.css("font-size"),textDecoration:i.css("text-decoration"),fontWeight:i.css("font-weight"),fontStyle:i.css("font-style")},JetpackLikespostMessage(e,window.frames["likes-master"]),JetpackLikesBatchHandler(),jQuery(document).on("inview","div.jetpack-likes-widget-unloaded",function(){jetpackLikesWidgetQueue.push(this.id)})}),"showLikeWidget"===e.event&&jQuery("#"+e.id+" .post-likes-widget-placeholder").fadeOut("fast",function(){jQuery("#"+e.id+" .post-likes-widget").fadeIn("fast",function(){JetpackLikespostMessage({event:"likeWidgetDisplayed",blog_id:e.blog_id,post_id:e.post_id,obj_id:e.obj_id},window.frames["likes-master"])})}),"clickReblogFlair"===e.event&&wpcom_reblog.toggle_reblog_box_flair(e.obj_id),"showOtherGravatars"===e.event)){var t,i,s,a,d=jQuery("#likes-other-gravatars"),n=d.find("ul");d.hide(),n.html(""),d.find(".likes-text span").text(e.total),jQuery.each(e.likers,function(e,t){n.append('<li class="'+t.css_class+'"><a href="'+t.profile_URL+'" class="wpl-liker" rel="nofollow" target="_parent"><img src="'+t.avatar_URL+'" alt="'+t.name+'" width="30" height="30" style="padding-right: 3px;" /></a></li>')}),t=jQuery("[name='"+e.parent+"']").offset(),d.css("left",t.left+e.position.left-10+"px"),d.css("top",t.top+e.position.top-33+"px"),i=Math.floor(e.width/37),s=37*Math.ceil(e.likers.length/i)+13,s>204&&(s=204),d.css("height",s+"px"),d.css("width",37*i-7+"px"),n.css("width",37*i+"px"),d.fadeIn("slow"),a=n[0].offsetWidth-n[0].clientWidth,a>0&&(d.width(d.width()+a),n.width(n.width()+a))}}function JetpackLikesWidgetQueueHandler(){var e,t,i;if(!jetpackLikesMasterReady)return void setTimeout(JetpackLikesWidgetQueueHandler,500);if(jetpackLikesWidgetQueue.length>0){for(i=!1;jetpackLikesWidgetQueue.length>0;)if(t=jetpackLikesWidgetQueue.splice(0,1)[0],jQuery("#"+t).hasClass("jetpack-likes-widget-unloaded")){i=!0;break}if(!i)return void setTimeout(JetpackLikesWidgetQueueHandler,500)}else if(jQuery("div.jetpack-likes-widget-unloaded").length>0&&(JetpackLikesBatchHandler(),t=jQuery("div.jetpack-likes-widget-unloaded").first()[0].id,!t))return void setTimeout(JetpackLikesWidgetQueueHandler,500);return"undefined"==typeof t?void setTimeout(JetpackLikesWidgetQueueHandler,500):(e=jQuery("#"+t),e.find("iframe").remove(),e.hasClass("slim-likes-widget")?e.find(".post-likes-widget-placeholder").after('<iframe class="post-likes-widget jetpack-likes-widget" name="'+e.data("name")+'" height="22px" width="68px" frameBorder="0" scrolling="no" src="'+e.data("src")+'"></iframe>'):e.find(".post-likes-widget-placeholder").after('<iframe class="post-likes-widget jetpack-likes-widget" name="'+e.data("name")+'" height="55px" width="100%" frameBorder="0" src="'+e.data("src")+'"></iframe>'),e.removeClass("jetpack-likes-widget-unloaded").addClass("jetpack-likes-widget-loading"),e.find("iframe").load(function(t){var i=jQuery(t.target);e.removeClass("jetpack-likes-widget-loading").addClass("jetpack-likes-widget-loaded"),JetpackLikespostMessage({event:"loadLikeWidget",name:i.attr("name"),width:i.width()},window.frames["likes-master"]),e.hasClass("slim-likes-widget")&&e.find("iframe").Jetpack("resizeable")}),void setTimeout(JetpackLikesWidgetQueueHandler,250))}var jetpackLikesWidgetQueue=[],jetpackLikesWidgetBatch=[],jetpackLikesMasterReady=!1;pm.bind("likesMessage",function(e){JetpackLikesMessageListener(e)}),jQuery(document).click(function(e){var t=jQuery("#likes-other-gravatars");0===t.has(e.target).length&&t.fadeOut("slow")}),JetpackLikesWidgetQueueHandler();