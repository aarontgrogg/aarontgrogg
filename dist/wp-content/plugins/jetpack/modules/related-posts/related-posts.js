!function(t){var e={response:null,getEndpointURL:function(e){var s=document.location;"string"==typeof e&&e.match(/^https?:\/\//)&&(s=document.createElement("a"),s.href=e);var a="relatedposts=1";t("#jp-relatedposts").data("exclude")||(a+="&relatedposts_exclude="+t("#jp-relatedposts").data("exclude"));var p=s.pathname;return"/"!==p[0]&&(p="/"+p),""===s.search?p+"?"+a:p+s.search+"&"+a},getAnchor:function(e,s){var a=e.title;""!=""+e.excerpt&&(a+="\n\n"+e.excerpt);var p=t("<a>");p.attr({"class":s,href:e.url,title:a,rel:e.rel,"data-origin":e.url_meta.origin,"data-position":e.url_meta.position});var r=t("<div>").append(p).html();return[r.substring(0,r.length-4),"</a>"]},generateMinimalHtml:function(e){var s=this,a="";return t.each(e,function(t,e){var p=s.getAnchor(e,"jp-relatedposts-post-a"),r="jp-relatedposts-post jp-relatedposts-post"+t;e.classes.length>0&&(r+=" "+e.classes.join(" ")),a+='<p class="'+r+'" data-post-id="'+e.id+'" data-post-format="'+e.format+'">',a+='<span class="jp-relatedposts-post-title">'+p[0]+e.title+p[1]+"</span>",a+='<span class="jp-relatedposts-post-date">'+e.date+"</span>",a+='<span class="jp-relatedposts-post-context">'+e.context+"</span>",a+="</p>"}),'<div class="jp-relatedposts-items jp-relatedposts-items-minimal">'+a+"</div>"},generateVisualHtml:function(e){var s=this,a="";return t.each(e,function(e,p){var r=s.getAnchor(p,"jp-relatedposts-post-a"),o="jp-relatedposts-post jp-relatedposts-post"+e;if(p.classes.length>0&&(o+=" "+p.classes.join(" ")),o+=p.img.src?" jp-relatedposts-post-thumbs":" jp-relatedposts-post-nothumbs",a+='<div class="'+o+'" data-post-id="'+p.id+'" data-post-format="'+p.format+'">',p.img.src)a+=r[0]+'<img class="jp-relatedposts-post-img" src="'+p.img.src+'" width="'+p.img.width+'" alt="'+p.title+'" />'+r[1];else{var l=s.getAnchor(p,"jp-relatedposts-post-a jp-relatedposts-post-aoverlay");a+=l[0]+l[1]}a+='<h4 class="jp-relatedposts-post-title">'+r[0]+p.title+r[1]+"</h4>",a+='<p class="jp-relatedposts-post-excerpt">'+t("<p>").text(p.excerpt).html()+"</p>",a+='<p class="jp-relatedposts-post-date">'+p.date+"</p>",a+='<p class="jp-relatedposts-post-context">'+p.context+"</p>",a+="</div>"}),'<div class="jp-relatedposts-items jp-relatedposts-items-visual">'+a+"</div>"},setVisualExcerptHeights:function(){var e=t("#jp-relatedposts .jp-relatedposts-post-nothumbs .jp-relatedposts-post-excerpt");if(!(0>=e.length)){var s=parseInt(e.first().css("font-size"),10),a=parseInt(e.first().css("line-height"),10);e.css("max-height",5*a/s+"em")}},getTrackedUrl:function(e){var s="relatedposts_hit=1";s+="&relatedposts_origin="+t(e).data("origin"),s+="&relatedposts_position="+t(e).data("position");var a=e.pathname;return"/"!==a[0]&&(a="/"+a),""===e.search?a+"?"+s:a+e.search+"&"+s},cleanupTrackedUrl:function(){if("function"==typeof history.replaceState){var t=document.location.search.replace(/\brelatedposts_[a-z]+=[0-9]*&?\b/gi,"");"?"===t&&(t=""),document.location.search!==t&&history.replaceState({},document.title,document.location.pathname+t)}}};t(function(){e.cleanupTrackedUrl(),t.getJSON(e.getEndpointURL(),function(s){if(0!==s.items.length&&0!==t("#jp-relatedposts").length){e.response=s;var a="";a=s.show_thumbnails?e.generateVisualHtml(s.items):e.generateMinimalHtml(s.items),t("#jp-relatedposts").append(a),e.setVisualExcerptHeights(),t("#jp-relatedposts").show(),t("#jp-relatedposts a.jp-relatedposts-post-a").click(function(){this.href=e.getTrackedUrl(this)})}})})}(jQuery);